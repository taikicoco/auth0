# Backend API Server

Auth0を使用したJWT認証機能を持つGoのAPIサーバーです。

## 概要

このアプリケーションは、Echo Webフレームワークを使用して構築されたRESTful APIサーバーで、Auth0によるJWT(JSON Web Token)認証を実装しています。公開エンドポイントと認証が必要な保護されたエンドポイントの両方を提供します。

## 主要な機能

### 1. 設定管理 (`loadConfig`)
- `.env`ファイルから環境変数を読み込み
- 必須環境変数
  - `AUTH0_DOMAIN`: Auth0のドメイン
  - `AUTH0_AUDIENCE`: Auth0のAPIオーディエンス
- オプション環境変数
  - `PORT`: サーバーのポート番号(デフォルト: 8080)

### 2. JWT検証器のセットアップ (`setupJWTValidator`)
- Auth0のJWKS(JSON Web Key Set)エンドポイントからの公開鍵を使用
- RS256アルゴリズムによる署名検証
- JWKSキャッシュ(5分間)による性能最適化
- 1分間のクロックスキュー許容

### 3. HTTPサーバーのセットアップ (`setupServer`)
- Echoフレームワークの初期化
- ミドルウェアの設定
  - ロガー：リクエストのログ記録
  - リカバリー：パニック時の自動復旧
  - CORS：クロスオリジンリクエストの許可

### 4. ルーティング (`setupRoutes`)

#### 公開エンドポイント
- `GET /public`: 認証不要でアクセス可能

#### 保護されたエンドポイント
- `GET /protected/profile`: JWTトークンによる認証が必要
  - ユーザーIDとクレーム情報を返す

### 5. JWT認証ミドルウェア (`jwtMiddleware`)
- Authorizationヘッダーからトークンを抽出
- トークンの検証(署名、有効期限、発行者、オーディエンス)
- 検証済みクレームをコンテキストに保存

### 6. トークン抽出 (`extractToken`)
- HTTPヘッダーから「Bearer」スキームのトークンを抽出

## カスタムクレーム

`CustomClaims`構造体により、標準のJWTクレームに加えて追加のクレーム(例：`scope`)をサポートしています。

## エラーハンドリング

- 環境変数の欠如：起動時にエラー
- 無効なトークン：401 Unauthorizedレスポンス
- 内部エラー：500 Internal Server Errorレスポンス

## セキュリティ機能

- JWTトークンによる認証
- RS256署名アルゴリズム
- トークンの有効期限チェック
- 発行者とオーディエンスの検証
- CORS対応

## 起動方法

1. 環境変数を設定(`.env`ファイルまたは環境変数)
2. `go run main.go`でサーバーを起動
3. デフォルトでは`http://localhost:8080`でリッスン